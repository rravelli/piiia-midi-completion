# Midi transformer

## Installations

First of all go to the root directory

```bash
cd midi_transformer
```

Then install all dependencies
```bash
pip install -r requirements.txt
```

## Train the model

To train the model, you can change some parameters in the following files : 
- in training.py, change number of epochs, number of files taken from the training dataset and number of files taken from the validation dataset
- in tokenizer.py, change the size of the batches and the length of sequences

Then, execute the following : 

```bash
python training.py
```

At the end of the training, all training datas, including weights, json with parameters used, and a plotting of accuracy and loss evolution, can be found in the right dated folder found at the following path : 

```bash
midi_transformer/training_data/
```

## Generate midi

Make sure you have training datas copied or generated. Then go to inference.py and do the following in the if __name__ == "__main__" part at the bottom :
- change file to the path to the file you would want to complete
- change token_count to the number of token you would want to generate. Keep in mind that a token is not a note, but a pitch, a duration, a velocity, a bar, or a position. See [click here](https://miditok.readthedocs.io/en/v3.0.1/tokenizations.html#remi) for more information about tokens.
- change weights_path to the path to your training data. Remember to add cp.ckpt after the date folder.
- change output_dir to the output directory you would want
- if you want a wave output, in addition to a MIDI output to be generated, choose generate_audio= True, else choose False.

Then generate midi with

```bash
python inference.py
```

You will get three files : input, output and final. Input should be the file to be completed, output the notes generated by the model, and final, the concatenation of both.

## Copyright

The MAESTRO dataset used to train our Transformer, was introduced in the following paper :

@inproceedings{
  hawthorne2018enabling,
  title={Enabling Factorized Piano Music Modeling and Generation with the {MAESTRO} Dataset},
  author={Curtis Hawthorne and Andriy Stasyuk and Adam Roberts and Ian Simon and Cheng-Zhi Anna Huang and Sander Dieleman and Erich Elsen and Jesse Engel and Douglas Eck},
  booktitle={International Conference on Learning Representations},
  year={2019},
  url={https://openreview.net/forum?id=r1lYRjC9F7},
}